webpackJsonp([2],{"2pb0":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=e("//Fk"),n=e.n(s),l=e("1lyH"),i=e("M4fF"),r={name:"DataLakeDataSyncSchedulingDialog",components:{},mixins:[],data:function(){return{dialogVisible:!1,taskData:{},rules:{rate:[{required:!0,message:"请选择执行频率",trigger:"change"}],cron:[{required:!0,message:"请输入cron表达式",trigger:"change"}]}}},computed:{},watch:{},created:function(){},methods:{open:function(t){this.taskData=i.cloneDeep(t),this.$set(this.taskData,"isScheduling",!!t.cron),this.dialogVisible=!0},onRateChange:function(){switch(this.taskData.rate){case"每天":this.taskData.cron="0 0 0 ? * *";break;case"每小时":this.taskData.cron="0 0 * ? * *"}},confirm:i.debounce(function(){var t=this;this.$refs.form.validate(function(a){a&&t.save()})},300,{leading:!1,trailing:!0}),save:function(){var t=this,a={incrementField:this.taskData.incrementField,cron:"",isMount:this.taskData.isMount,rate:""};this.taskData.isScheduling&&(a={incrementField:this.taskData.incrementField,cron:this.taskData.cron,isMount:this.taskData.isMount,rate:this.taskData.rate});var e={tableId:this.taskData.tableId};Object(l.pdAjax)({vm:this,path:e},{method:"POST",url:"/kgdatalake/etl/task/config/{tableId}"},{data:a}).then(function(a){return t.$message.success("配置成功"),t.$emit("update"),t.dialogVisible=!1,n.a.resolve(a)},function(t){return n.a.reject(t)})}}},o={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("el-dialog",{staticClass:"data-lake-data-sync-scheduling-dialog",attrs:{title:"调度配置",visible:t.dialogVisible,width:"464px"},on:{"update:visible":function(a){t.dialogVisible=a}}},[e("div",{staticClass:"data-lake-data-sync-scheduling-dialog-content"},[e("el-form",{ref:"form",staticClass:"data-lake-data-sync-scheduling-dialog-form",attrs:{rules:t.rules,model:t.taskData,"label-width":"100px","label-position":"left"}},[e("el-form-item",{attrs:{label:"任务调度",prop:"isScheduling"}},[e("el-switch",{attrs:{size:"small"},model:{value:t.taskData.isScheduling,callback:function(a){t.$set(t.taskData,"isScheduling",a)},expression:"taskData.isScheduling"}})],1),t._v(" "),e("div",{staticClass:"data-lake-data-sync-scheduling-dialog-form-tip"},[e("span",[t._v("* ")]),t._v("\n        开启调度后可定时执行任务\n      ")]),t._v(" "),t.taskData.isScheduling?e("el-form-item",{attrs:{label:"执行频率",prop:"rate"}},[e("el-select",{attrs:{size:"small",placeholder:"请选择"},on:{change:t.onRateChange},model:{value:t.taskData.rate,callback:function(a){t.$set(t.taskData,"rate",a)},expression:"taskData.rate"}},[e("el-option",{attrs:{label:"每天",value:"每天"}}),t._v(" "),e("el-option",{attrs:{label:"每小时",value:"每小时"}}),t._v(" "),e("el-option",{attrs:{label:"自定义",value:"自定义"}})],1)],1):t._e(),t._v(" "),t.taskData.isScheduling?e("el-form-item",{attrs:{label:"cron表达式",prop:"cron"}},[e("el-input",{attrs:{size:"small",disabled:"自定义"!==t.taskData.rate},model:{value:t.taskData.cron,callback:function(a){t.$set(t.taskData,"cron","string"==typeof a?a.trim():a)},expression:"taskData.cron"}})],1):t._e(),t._v(" "),t.taskData.isScheduling?e("div",{staticClass:"data-lake-data-sync-scheduling-dialog-form-tip data-lake-data-sync-scheduling-dialog-form-tip-far"},[t._v("\n        语句可参考"),e("a",{attrs:{target:"_blank",href:"https://www.pppet.net/"}},[t._v("https://www.pppet.net/")])]):t._e()],1)],1),t._v(" "),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:function(a){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.confirm}},[t._v("确 定")])],1)])},staticRenderFns:[]};var c={name:"DataLakeDataSync",components:{DataLakeDataSyncSchedulingDialog:e("VU/8")(r,o,!1,function(t){e("9pr4")},"data-v-2fea833e",null).exports},mixins:[],data:function(){return{pageSize:10,pageNo:1,total:1,selectedDatasetId:null,tableData:[],kw:"",datasetList:[]}},computed:{},watch:{},created:function(){var t=this.$route.query.datasetId;t=parseInt(t),this.selectedDatasetId=isNaN(t)?"":t;var a=this.$route.query.pageNo;a=parseInt(a),this.pageNo=isNaN(a)?1:a,this.getList(this.pageNo),this.getDatasetList()},methods:{getList:function(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e={page:a,size:this.pageSize,sorts:["createTime:DESC"]};Object(l.pdAjax)({vm:this,path:{datasetId:this.selectedDatasetId||0}},{method:"POST",url:"/kgdatalake/etl/task/list/{datasetId}"},{data:e}).then(function(e){t.pageNo=a,t.total=e.totalElements,t.tableData=e.data;var s=i.cloneDeep(t.$route.query);return t.selectedDatasetId?s.datasetId=t.selectedDatasetId:delete s.datasetId,s.pageNo=a,t.$router.push({query:s}),n.a.resolve(e)},function(a){return t.tableData=[],t.$message.error(a.message),n.a.reject(a)})},getDatasetList:function(){var t=this;Object(l.pdAjax)({vm:this,path:{type:3}},{method:"GET",url:"/kgdatalake/dataset/list/{type}"}).then(function(a){return t.datasetList=i.filter(a,["dataSetType","remoteDb"]),n.a.resolve(a)},function(t){return n.a.reject(t)})},getStatus:function(t){return{NONE:"未调度",SUCCESS:"成功",FAIL:"失败",WORK:"进行中"}[t]||t},getTableLabel:function(t){return{common:"普通结构",pdd2r:"pdd2r",pddoc:"pddoc"}[t]||t},singleExecution:function(t){var a=this,e={id:t.jobId,stdFireTime:0,stdDataOffset:0,userId:Object(l.getConfig)().user.id};Object(l.pdAjax)({vm:this},l.apiXxlAdminSdk.run_post,{data:e,params:{userId:null}}).then(function(){a.$message.success("任务执行成功"),a.getList(a.pageNo)},function(t){a.getList(a.pageNo),a.$message.error(t.message)})},goRecord:function(t){this.$router.push({name:"dataLakeDataSyncExecRecord",params:{taskId:t.jobId}})},openDataLakeDataSyncSchedulingDialog:function(t){this.$refs.dataLakeDataSyncSchedulingDialog.open(t)}}},d={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"data-manage-container kgms-el-main kg-el-main data-lake-data-sync"},[t._m(0),t._v(" "),e("div",{staticClass:"page-content data-lake-data-sync-content"},[e("div",{staticClass:"data-lake-data-sync-header"},[e("div",{staticClass:"data-lake-data-sync-header-left"},[e("el-select",{attrs:{size:"small",clearable:"",filterable:"",placeholder:"请选择数据集"},on:{change:function(a){return t.getList(1)}},model:{value:t.selectedDatasetId,callback:function(a){t.selectedDatasetId=a},expression:"selectedDatasetId"}},t._l(t.datasetList,function(t){return e("el-option",{key:t.id,attrs:{label:t.name,title:t.name,value:t.id}})}),1)],1),t._v(" "),e("div",{staticClass:"data-lake-data-sync-header-right"},[e("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(a){return t.getList(t.pageNo)}}},[t._v("刷新\n          ")])],1)]),t._v(" "),e("div",{staticClass:"data-lake-data-sync-container"},[e("el-table",{staticClass:"data-lake-data-sync-table",staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""}},[e("el-table-column",{attrs:{prop:"jobId",label:"ID",width:"60"}}),t._v(" "),e("el-table-column",{attrs:{prop:"datasetName",label:"数据集"}}),t._v(" "),e("el-table-column",{attrs:{prop:"tableName",label:"数据表"}}),t._v(" "),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"remoteUrl",label:"源数据库表"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{staticClass:"weak-font"},[t._v("\n              "+t._s(a.row.remoteUrl)+" / "+t._s(a.row.datasetName)+" / "+t._s(a.row.tableName)+"\n              ")])]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"etlType",width:"180px",label:"配置"},scopedSlots:t._u([{key:"default",fn:function(a){return[t._v("\n              "+t._s(a.row.isMount?"远程挂载":"本地接入")+"\n              "),a.row.isMount?t._e():[t._v("\n                |\n                "+t._s(a.row.incrementField?"增量接入":"全量接入")+"\n              ")]]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"cron",width:"120px","show-overflow-tooltip":"",label:"定时周期 "},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.cron&&"自定义"!==a.row.rate?e("span",[t._v(t._s(a.row.rate))]):a.row.cron?e("span",[t._v(t._s(a.row.cron))]):e("span",{staticClass:"weak-font"},[t._v("关闭")])]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"lastRunStatus",width:"120px",label:"最新执行状态 "},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{staticClass:"data-lake-data-sync-table-status",class:"data-lake-data-sync-table-status-"+a.row.lastRunStatus},[t._v("\n                "+t._s(t.getStatus(a.row.lastRunStatus))+"\n              ")])]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"createTime",width:"160px",label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(a){return[t._v("\n              "+t._s(t._f("secondTimeFilter")(a.row.createTime))+"\n            ")]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"address",width:"220px",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-link",{attrs:{underline:!1,disabled:"WORK"===a.row.lastRunStatus||a.row.isMount,type:"primary"},on:{click:function(e){return t.singleExecution(a.row)}}},[t._v("单次执行\n              ")]),t._v(" "),e("el-link",{attrs:{underline:!1,disabled:"WORK"===a.row.lastRunStatus||a.row.isMount,type:"primary"},on:{click:function(e){return t.openDataLakeDataSyncSchedulingDialog(a.row)}}},[t._v("调度配置\n              ")]),t._v(" "),e("el-link",{attrs:{disabled:a.row.isMount,underline:!1,type:"primary"},on:{click:function(e){return t.goRecord(a.row)}}},[t._v("执行记录\n              ")])]}}])})],1)],1),t._v(" "),e("div",{staticClass:"data-lake-data-sync-footer"},[e("el-pagination",{attrs:{"current-page":t.pageNo,"page-size":t.pageSize,layout:"total, prev, next, jumper",total:t.total},on:{"current-change":t.getList,"update:currentPage":function(a){t.pageNo=a},"update:current-page":function(a){t.pageNo=a}}})],1)]),t._v(" "),e("data-lake-data-sync-scheduling-dialog",{ref:"dataLakeDataSyncSchedulingDialog",on:{update:function(a){return t.getList(t.pageNo)}}})],1)},staticRenderFns:[function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"page-header"},[a("div",{staticClass:"title"},[this._v("\n        数据同步\n      ")]),this._v(" "),a("span",{staticClass:"flex-1"})])}]};var u=e("VU/8")(c,d,!1,function(t){e("serk")},"data-v-63cc5bda",null);a.default=u.exports},"9pr4":function(t,a){},serk:function(t,a){}});